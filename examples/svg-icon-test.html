<!DOCTYPE html>
<html ng-app="svg">
    <head>
        <title>style example</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css" type="text/css">
        <link rel="stylesheet" href="../dist/mapstory-style-editor.css" type="text/css">
        <link rel="stylesheet" href="../bower_components/angular-bootstrap-colorpicker/css/colorpicker.css" type="text/css">

        <script src="../bower_components/angular/angular.min.js" type="text/javascript"></script>
        <script type="text/javascript" src="../bower_components/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script>
        <script type="text/javascript" src="../bower_components/angular-bootstrap-colorpicker/js/bootstrap-colorpicker-module.js"></script>
        <script src="ol.js" type="text/javascript"></script>
        <script type="text/javascript">
            var layer;
            angular.module('svg', [])
                .run(function() {
                    map = new ol.Map({
                        layers: [new ol.layer.Tile({
                                source: new ol.source.MapQuest({layer: 'sat'})
                            })],
                        target: 'map',
                        view: new ol.View({
                            center: [0, 0],
                            zoom: 3
                        })
                    });
                    layer = new ol.layer.Vector({
                        source: new ol.source.Vector({
                            features: [new ol.Feature({'geometry': new ol.geom.Point([0, 0])})]
                        })
                    });
                    map.addLayer(layer);
                })
                .controller('svgc', function($scope, $http) {
                    var image = angular.element(document.getElementById('svg-image'));
                    $http({method: 'GET', url: 'marker.svg'}).success(
                        function(data, status, headers, config) {
                            $scope.svg = data;
                            image.html(data);
                            $scope.style();
                        });
                    $scope.size = 24;
                    $scope.color = "#bada55";
                    function style() {
                        image.html($scope.svg);
                        image.find('path').css('fill', $scope.color);
                        $scope.svg = image.html();
                        var src = 'data:image/svg+xml;base64,' + btoa($scope.svg);
                        var style = [new ol.style.Style({
                            image: new ol.style.Icon({
                                src: src,
                                scale: $scope.size / 24, // @todo 24 is native size
                                opacity: 1
                            })
                        })];
                        layer.setStyle(style);
                    };
                    ['size','color','svg'].forEach(function(s) {
                        $scope.$watch(s, style);
                    });
                });
        </script>
    </head>
    <body ng-controller="svgc">
        <div>
            <label>size</label><input type="number" ng-model="size">
        </div>
        <div>
            <label>color</label><input type="color" ng-model="color">
        </div>
        <div id="map" style="height:300px"></div>
        <textarea cols="80" rows="10" id="svg" ng-model="svg"></textarea>
        <div id="svg-image"></div>
    </body>
</html>
